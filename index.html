<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<title id="title"></title>
<script type="text/javascript">
window.onload = function() {

	function ajaj(url, onload)
	{
		var request = new XMLHttpRequest();
		request.onreadystatechange = function() {
			if (request.readyState === 4)
			{
				var json = JSON.parse(request.response);
				onload(json);
			}
		}
		request.open('GET', url, true);
		request.setRequestHeader('User-Agent', 'yurivkhan/literate-github');
		request.send(null);
	}

	function listCommits()
	{
		ajaj(base + '/commits?sha=' + branch, function(json) {
			var commits = document.getElementById('commits');
			json.forEach(function(commit) {
				var parts = /^([^\0]*?)(?:\n{2,}([^\0]*))?$/.exec(commit.commit.message);

				var li = document.createElement('li');
				var a = document.createElement('a');
				a.textContent = parts[1];
				a.href = '?sha=' + commit.sha;
				li.appendChild(a);
				commits.appendChild(li);
			});
		});
	}

	var base = 'https://api.github.com/repos/yurivkhan/literate-github';
	var branch = 'master';

	ajaj(base, function(json) {
		document.getElementById('title').textContent = json.full_name;
		document.getElementById('description').textContent = json.description;
	});

	listCommits();
}
</script>
</head>
<body>
<h1 id="description"></h1>
<ul id="commits">
</ul>
</body>
</html>
